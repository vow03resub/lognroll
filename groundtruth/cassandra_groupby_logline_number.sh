#!/bin/bash

# [Service Thread] is two words. So, I have to make it into one word before doing awk.
#cat ../log_sample/cassandra_debug.log | sed 's/\[Service Thread\]/[Service_Thread]/g' | awk '{print $5}' | egrep -e '[A-Za-z]' | sort | uniq -c | sort -nr

#LLN="ColumnFamilyStore.java:899 Memtable.java:490 Memtable.java:461 ColumnFamilyStore.java:1197 CompactionTask.java:155 CompactionTask.java:255 IndexSummaryRedistribution.java:75 Schema.java:425 ColumnFamilyStore.java:406 SSTableReader.java:506 ColumnFamilyStore.java:954 AutoSavingCache.java:394 StorageService.java:2322 AbstractCommitLogSegmentManager.java:107 CassandraDaemon.java:484 ViewManager.java:137 CassandraDaemon.java:290 YamlConfigurationLoader.java:108 AbstractCommitLogSegmentManager.java:329 CommitLog.java:317 StartupChecks.java:280 StorageService.java:1441 StorageService.java:606 StorageService.java:599 HintsService.java:220 TokenMetadata.java:479 MigrationManager.java:572 StorageService.java:2252 StorageService.java:2255 CommitLogReader.java:223 CommitLogReader.java:214 YamlConfigurationLoader.java:89 StartupChecks.java:197 StartupChecks.java:160 SigarLibrary.java:44 SigarLibrary.java:174 RateBasedBackPressure.java:123 QueryProcessor.java:115 NativeLibrary.java:174 JMXServerUtils.java:249 DatabaseDescriptor.java:710 DatabaseDescriptor.java:424 DatabaseDescriptor.java:420 DatabaseDescriptor.java:366 DatabaseDescriptor.java:358 Config.java:481 CassandraDaemon.java:488 CassandraDaemon.java:486 CassandraDaemon.java:479 CassandraDaemon.java:478 CassandraDaemon.java:471 CacheService.java:174 CacheService.java:163 CacheService.java:134 CacheService.java:112 BufferPool.java:230 ApproximateTime.java:44 StorageService.java:849 StorageService.java:819 StorageService.java:706 StorageService.java:621 StorageService.java:619 StorageService.java:618 StorageService.java:617 StorageService.java:549 QueryProcessor.java:162 MessagingService.java:753 IndexSummaryManager.java:85 AutoSavingCache.java:173 StartupChecks.java:127 MessagingService.java:984 MessagingService.java:1338 Gossiper.java:1530 CommitLogReplayer.java:129 CommitLog.java:159 CommitLog.java:157 AutoSavingCache.java:197 OutboundTcpConnection.java:545 SecondaryIndexManager.java:508 StorageService.java:231 StorageService.java:1439 Server.java:156 Server.java:155 NativeTransportService.java:70 CassandraDaemon.java:527 StorageService.java:992 CassandraDaemon.java:706 CassandraDaemon.java:408 Server.java:176 OutputHandler.java:42 MigrationManager.java:310 StartupChecks.java:286 StartupChecks.java:131 MigrationManager.java:426 CFMetaData.java:793 CFMetaData.java:768 MigrationManager.java:355 DebuggableScheduledThreadPoolExecutor.java:57 SystemKeyspace.java:1083 StorageService.java:977 StorageService.java:857 OutboundTcpConnection.java:424 NoSpamLogger.java:94 MigrationManager.java:406 CommitLog.java:152 CassandraRoleManager.java:355 CassandraIndex.java:719 CassandraIndex.java:707 ReadCallback.java:132 OutboundTcpConnection.java:560 OutboundTcpConnection.java:532 NoSpamLogger.java:91 MonitoringTask.java:93 MonitoringTask.java:173 MigrationManager.java:478 MigrationManager.java:462 CassandraRoleManager.java:399 CassandraRoleManager.java:360" 

LLN="ColumnFamilyStore.java:899 Memtable.java:490 Memtable.java:461 ColumnFamilyStore.java:1197 CompactionTask.java:155 CompactionTask.java:255 IndexSummaryRedistribution.java:75 Schema.java:425 ColumnFamilyStore.java:406 SSTableReader.java:506 ColumnFamilyStore.java:954 AutoSavingCache.java:394 StorageService.java:2322 AbstractCommitLogSegmentManager.java:107 CassandraDaemon.java:484 ViewManager.java:137 CassandraDaemon.java:290 YamlConfigurationLoader.java:108 AbstractCommitLogSegmentManager.java:329 CommitLog.java:317 StartupChecks.java:280 StatusLogger.java:101 StorageService.java:1441 StorageService.java:606 StorageService.java:599 HintsService.java:220 TokenMetadata.java:479 StatusLogger.java:51 MigrationManager.java:572 StorageService.java:2252 StorageService.java:2255 CommitLogReader.java:223 CommitLogReader.java:214 YamlConfigurationLoader.java:89 StartupChecks.java:197 StartupChecks.java:160 SigarLibrary.java:44 SigarLibrary.java:174 RateBasedBackPressure.java:123 QueryProcessor.java:115 NativeLibrary.java:174 JMXServerUtils.java:249 DatabaseDescriptor.java:710 DatabaseDescriptor.java:424 DatabaseDescriptor.java:420 DatabaseDescriptor.java:366 DatabaseDescriptor.java:358 Config.java:481 CassandraDaemon.java:488 CassandraDaemon.java:486 CassandraDaemon.java:479 CassandraDaemon.java:478 CassandraDaemon.java:471 CacheService.java:174 CacheService.java:163 CacheService.java:134 CacheService.java:112 BufferPool.java:230 ApproximateTime.java:44 StorageService.java:849 StorageService.java:819 StorageService.java:706 StorageService.java:621 StorageService.java:619 StorageService.java:618 StorageService.java:617 StorageService.java:549 QueryProcessor.java:162 MessagingService.java:753 IndexSummaryManager.java:85 AutoSavingCache.java:173 StartupChecks.java:127 MessagingService.java:984 MessagingService.java:1338 Gossiper.java:1530 CommitLogReplayer.java:129 CommitLog.java:159 CommitLog.java:157 AutoSavingCache.java:197 OutboundTcpConnection.java:545 SecondaryIndexManager.java:508 StorageService.java:231 StorageService.java:1439 Server.java:156 Server.java:155 NativeTransportService.java:70 CassandraDaemon.java:527 StorageService.java:992 CassandraDaemon.java:706 CassandraDaemon.java:408 Server.java:176 GCInspector.java:284 OutputHandler.java:42 MigrationManager.java:310 StartupChecks.java:286 StartupChecks.java:131 MigrationManager.java:426 CFMetaData.java:793 CFMetaData.java:768 MigrationManager.java:355 DebuggableScheduledThreadPoolExecutor.java:57 StatusLogger.java:98 StatusLogger.java:91 StatusLogger.java:85 StatusLogger.java:83 StatusLogger.java:73 StatusLogger.java:61 StatusLogger.java:47 GCInspector.java:282 SystemKeyspace.java:1083 StorageService.java:977 StorageService.java:857 OutboundTcpConnection.java:424 NoSpamLogger.java:94 MigrationManager.java:406 CommitLog.java:152 CassandraRoleManager.java:355 CassandraIndex.java:719 CassandraIndex.java:707 ReadCallback.java:132 OutboundTcpConnection.java:560 OutboundTcpConnection.java:532 NoSpamLogger.java:91 MonitoringTask.java:93 MonitoringTask.java:173 MigrationManager.java:478 MigrationManager.java:462 CassandraRoleManager.java:399 CassandraRoleManager.java:360"

for lln in $LLN
do
    clear
    #echo $lln
    cat ../log_sample/cassandra_debug.log | grep $lln | head -70
    read -p "Press Enter to continue" Status
done

